<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>名牌產生器 | NameTag Generator</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://unpkg.com/docx@8.2.2/build/index.umd.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
</head>
<body>
    <!-- Main App -->
    <div class="app-container active" id="appContainer">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <span class="header-logo">NameTag Generator</span>
            </div>
            <div class="header-right">
                <span style="color: var(--text-secondary); font-size: 14px;">名牌產生器</span>
            </div>
        </header>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Sidebar -->
            <aside class="sidebar">
                <!-- Data Import Panel -->
                <div class="panel" id="importPanel">
                    <div class="panel-header">
                        <span class="panel-title">
                            <span class="panel-icon">1</span>
                            資料匯入
                        </span>
                        <span class="panel-toggle">▼</span>
                    </div>
                    <div class="panel-content">
                        <div class="upload-zone" id="uploadZone">
                            <div class="upload-icon">📁</div>
                            <div class="upload-text">點擊或拖放檔案至此</div>
                            <div class="upload-hint">支援 .xlsx, .xls, .csv 格式</div>
                            <input type="file" class="file-input" id="fileInput" accept=".xlsx,.xls,.csv">
                        </div>
                        <div class="file-info" id="fileInfo" style="display: none;"></div>

                        <!-- Bus Tabs -->
                        <div class="bus-tabs" id="busTabs" style="display: none; margin-top: 16px;">
                            <div class="bus-tab active" data-bus="A">A車 <span class="count">0</span></div>
                            <div class="bus-tab" data-bus="B">B車 <span class="count">0</span></div>
                            <div class="bus-tab" data-bus="C">C車 <span class="count">0</span></div>
                            <div class="bus-tab" data-bus="D">D車 <span class="count">0</span></div>
                            <div class="bus-tab" data-bus="E">E車 <span class="count">0</span></div>
                        </div>

                        <div style="margin-top: 12px;">
                            <button class="quick-btn" id="clearDataBtn" style="width: 100%;">清除資料</button>
                        </div>
                    </div>
                </div>

                <!-- Template Settings Panel -->
                <div class="panel" id="templatePanel">
                    <div class="panel-header">
                        <span class="panel-title">
                            <span class="panel-icon">2</span>
                            版型設定
                        </span>
                        <span class="panel-toggle">▼</span>
                    </div>
                    <div class="panel-content">
                        <div class="control-group">
                            <label class="control-label">公司名稱</label>
                            <input type="text" class="control-input" id="companyName" value="台灣通力電梯">
                        </div>
                        <div class="control-group">
                            <label class="control-label">活動名稱</label>
                            <input type="text" class="control-input" id="eventName" value="親清日月潭山系">
                        </div>
                        <div class="control-group">
                            <label class="control-label">旅行社資訊 (固定)</label>
                            <input type="text" class="control-input" id="travelInfo" value="FOUND WONDER TRAVEL 農新家旅遊" disabled style="opacity: 0.6; cursor: not-allowed;">
                        </div>
                        <div class="control-group">
                            <label class="control-label">車/船號標籤</label>
                            <input type="text" class="control-input" id="busLabel" value="★ 車 / 船號：">
                        </div>
                        <div class="control-group">
                            <label class="control-label">桌號標籤</label>
                            <input type="text" class="control-input" id="tableLabel" value="★ 桌　　號：">
                        </div>
                        <div class="control-group">
                            <label class="control-label">房號標籤</label>
                            <input type="text" class="control-input" id="roomLabel" value="★ 房　　號：">
                        </div>
                        <div class="control-group">
                            <label class="control-label">底部資訊 (依選擇的車次顯示)</label>
                            <textarea class="control-input" id="footerText" rows="2">A 車 領隊 黃啟翔 0935-670-825</textarea>
                        </div>
                    </div>
                </div>

                <!-- Font Size Panel -->
                <div class="panel" id="fontSizePanel">
                    <div class="panel-header">
                        <span class="panel-title">
                            <span class="panel-icon">3</span>
                            字型大小設定
                        </span>
                        <span class="panel-toggle">▼</span>
                    </div>
                    <div class="panel-content">
                        <div class="control-group">
                            <label class="control-label">公司名稱</label>
                            <div class="font-size-control">
                                <input type="range" class="font-size-slider" id="fontSizeCompany" min="2" max="8" step="0.5" value="3.5">
                                <span class="font-size-value" data-target="fontSizeCompany">3.5mm</span>
                            </div>
                        </div>
                        <div class="control-group">
                            <label class="control-label">活動名稱</label>
                            <div class="font-size-control">
                                <input type="range" class="font-size-slider" id="fontSizeEvent" min="3" max="10" step="0.5" value="5">
                                <span class="font-size-value" data-target="fontSizeEvent">5mm</span>
                            </div>
                        </div>
                        <div class="control-group">
                            <label class="control-label">姓名</label>
                            <div class="font-size-control">
                                <input type="range" class="font-size-slider" id="fontSizeName" min="12" max="40" step="1" value="12">
                                <span class="font-size-value" data-target="fontSizeName">12mm</span>
                            </div>
                        </div>
                        <div class="control-group">
                            <label class="control-label">旅行社資訊</label>
                            <div class="font-size-control">
                                <input type="range" class="font-size-slider" id="fontSizeTravel" min="2" max="6" step="0.5" value="2.8">
                                <span class="font-size-value" data-target="fontSizeTravel">2.8mm</span>
                            </div>
                        </div>
                        <div class="control-group">
                            <label class="control-label">標籤區 (車/桌/房號)</label>
                            <div class="font-size-control">
                                <input type="range" class="font-size-slider" id="fontSizeLabels" min="2" max="8" step="0.5" value="3.5">
                                <span class="font-size-value" data-target="fontSizeLabels">3.5mm</span>
                            </div>
                        </div>
                        <div class="control-group">
                            <label class="control-label">底部資訊</label>
                            <div class="font-size-control">
                                <input type="range" class="font-size-slider" id="fontSizeFooter" min="2" max="6" step="0.5" value="3">
                                <span class="font-size-value" data-target="fontSizeFooter">3mm</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Color Panel - Per Bus -->
                <div class="panel" id="colorPanel">
                    <div class="panel-header">
                        <span class="panel-title">
                            <span class="panel-icon">4</span>
                            顏色設定 (依車次)
                        </span>
                        <span class="panel-toggle">▼</span>
                    </div>
                    <div class="panel-content">
                        <div class="current-bus-indicator">
                            目前編輯：<span id="currentBusLabel">A</span> 車
                        </div>
                        <div class="color-row">
                            <div class="color-picker-wrap">
                                <input type="color" class="color-picker" id="bgColor" value="#d4e6d4">
                            </div>
                            <span class="color-label">背景顏色</span>
                        </div>
                        <div class="color-row">
                            <div class="color-picker-wrap">
                                <input type="color" class="color-picker" id="textColor" value="#2a4a2a">
                            </div>
                            <span class="color-label">文字顏色</span>
                        </div>
                        <div class="color-row">
                            <div class="color-picker-wrap">
                                <input type="color" class="color-picker" id="borderColor" value="#5a7a5a">
                            </div>
                            <span class="color-label">邊框顏色</span>
                        </div>
                    </div>
                </div>

                <!-- Size Panel - A4 Split -->
                <div class="panel" id="sizePanel">
                    <div class="panel-header">
                        <span class="panel-title">
                            <span class="panel-icon">5</span>
                            尺寸設定 (A4切割)
                        </span>
                        <span class="panel-toggle">▼</span>
                    </div>
                    <div class="panel-content">
                        <div class="size-presets">
                            <div class="size-preset" data-split="1">
                                <div class="size-preset-name">1份</div>
                                <div class="size-preset-dim">210×297</div>
                            </div>
                            <div class="size-preset" data-split="2">
                                <div class="size-preset-name">2份</div>
                                <div class="size-preset-dim">210×148</div>
                            </div>
                            <div class="size-preset active" data-split="4">
                                <div class="size-preset-name">4份</div>
                                <div class="size-preset-dim">105×148</div>
                            </div>
                            <div class="size-preset" data-split="6">
                                <div class="size-preset-name">6份</div>
                                <div class="size-preset-dim">105×99</div>
                            </div>
                            <div class="size-preset" data-split="9">
                                <div class="size-preset-name">9份</div>
                                <div class="size-preset-dim">70×99</div>
                            </div>
                        </div>

                        <button class="apply-btn" id="applyBtn" disabled>套用格式並預覽全部</button>
                    </div>
                </div>

                <!-- Export Panel -->
                <div class="panel" id="exportPanel">
                    <div class="panel-header">
                        <span class="panel-title">
                            <span class="panel-icon">6</span>
                            輸出選項
                        </span>
                        <span class="panel-toggle">▼</span>
                    </div>
                    <div class="panel-content">
                        <!-- Bus Selection for Batch Export -->
                        <div class="control-group">
                            <label class="control-label">選擇要匯出的車次</label>
                            <div class="bus-checkboxes" id="busCheckboxes">
                                <label class="bus-checkbox">
                                    <input type="checkbox" value="A" checked> A車 <span class="check-count" data-bus="A">0</span>
                                </label>
                                <label class="bus-checkbox">
                                    <input type="checkbox" value="B" checked> B車 <span class="check-count" data-bus="B">0</span>
                                </label>
                                <label class="bus-checkbox">
                                    <input type="checkbox" value="C" checked> C車 <span class="check-count" data-bus="C">0</span>
                                </label>
                                <label class="bus-checkbox">
                                    <input type="checkbox" value="D" checked> D車 <span class="check-count" data-bus="D">0</span>
                                </label>
                                <label class="bus-checkbox">
                                    <input type="checkbox" value="E" checked> E車 <span class="check-count" data-bus="E">0</span>
                                </label>
                            </div>
                            <div class="select-all-row">
                                <button class="quick-btn" id="selectAllBuses">全選</button>
                                <button class="quick-btn" id="deselectAllBuses">取消全選</button>
                            </div>
                        </div>

                        <div class="export-buttons">
                            <button class="export-btn primary" id="exportPdf" disabled>
                                <span>📄</span> 輸出 PDF (目前車次)
                            </button>
                            <button class="export-btn primary" id="exportSelectedPdf" disabled>
                                <span>📄</span> 批次輸出 PDF (已選車次)
                            </button>
                            <button class="export-btn word" id="exportWord" disabled>
                                <span>📝</span> 輸出 Word (目前車次)
                            </button>
                            <button class="export-btn word" id="exportSelectedWord" disabled>
                                <span>📝</span> 批次輸出 Word (已選車次)
                            </button>
                            <button class="export-btn secondary" id="printBtn" disabled>
                                <span>🖨️</span> 直接列印
                            </button>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- Preview Area -->
            <main class="preview-area">
                <div class="preview-header">
                    <h2 class="preview-title">名牌預覽</h2>
                    <span class="preview-count" id="previewCount">共 0 張名牌</span>
                </div>
                <div class="preview-mode-info" id="previewModeInfo" style="display: none;">
                    預覽模式：顯示第一張名牌，確認格式後請點擊「套用格式並預覽全部」
                </div>
                <div id="previewGrid">
                    <div class="empty-state">
                        <div class="empty-icon">📋</div>
                        <div class="empty-text">尚未匯入資料</div>
                        <div class="empty-hint">請從左側面板上傳 Excel 或 CSV 檔案</div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Edit Modal -->
    <div class="modal-overlay" id="editModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">編輯名牌</h3>
                <button class="modal-close" id="closeModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="control-group">
                    <label class="control-label">姓名</label>
                    <input type="text" class="control-input" id="editName">
                </div>
                <div class="control-group">
                    <label class="control-label">車/船號</label>
                    <input type="text" class="control-input" id="editBus">
                </div>
                <div class="control-group">
                    <label class="control-label">桌號</label>
                    <input type="text" class="control-input" id="editTable">
                </div>
                <div class="control-group">
                    <label class="control-label">房號</label>
                    <input type="text" class="control-input" id="editRoom">
                </div>
                <div class="control-group">
                    <label class="control-label">備註 (如：素食)</label>
                    <input type="text" class="control-input" id="editNote">
                </div>
                <div class="control-group">
                    <label class="control-label">姓名字體大小 (mm)</label>
                    <input type="number" class="control-input" id="editFontSize" value="12" min="12" max="40">
                </div>
                <div class="color-row" style="margin-top: 16px;">
                    <div class="color-picker-wrap">
                        <input type="color" class="color-picker" id="editBgColor" value="#d4e6d4">
                    </div>
                    <span class="color-label">個別背景色</span>
                </div>
            </div>
            <div class="modal-footer">
                <button class="quick-btn" id="cancelEdit">取消</button>
                <button class="export-btn primary" id="saveEdit" style="padding: 10px 20px;">儲存變更</button>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast">
        <span id="toastMessage">操作成功</span>
    </div>

    <!-- App JavaScript -->
    <script src="app.js"></script>
</body>
</html>
